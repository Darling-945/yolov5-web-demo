<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7QnpP1Ls17bCN8MEKD3x6zJ7sGU1m5ZmK" crossorigin="anonymous">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <title>YOLO Object Detection</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
      <div class="container">
        <!-- 左侧导航 -->
        <div class="navbar-nav d-none d-lg-flex">
          <a class="nav-link active" href="/">
            <i class="fas fa-home me-1"></i> 首页
          </a>
          <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">
            <i class="fas fa-info-circle me-1"></i> 关于
          </a>
        </div>

        <!-- 中间品牌 -->
        <a class="navbar-brand mx-auto fw-bold text-center" href="/" style="position: absolute; left: 50%; transform: translateX(-50%);">
          <i class="fas fa-eye me-2 text-primary"></i>
          YOLO Detection
        </a>

        <!-- 移动端品牌 -->
        <a class="navbar-brand d-lg-none fw-bold" href="/">
          <i class="fas fa-eye me-2 text-primary"></i>
          YOLO Detection
        </a>

        <!-- 右侧主题切换 -->
        <div class="d-flex align-items-center">
          <button class="btn btn-outline-secondary btn-sm" id="themeToggleNavbar" onclick="toggleTheme()">
            <i class="fas fa-moon" id="themeIcon"></i>
          </button>
        </div>

        <!-- 移动端菜单 -->
        <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

        <!-- 移动端导航菜单 -->
        <div class="collapse navbar-collapse d-lg-none" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link active" href="/">
                <i class="fas fa-home me-1"></i> 首页
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">
                <i class="fas fa-info-circle me-1"></i> 关于
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      {% block content %}{% endblock %}
    </div>

    <!-- 主题切换按钮 -->
    <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
      <i class="fas fa-moon" id="themeIconFloat"></i>
    </button>

    <!-- Toast 通知容器 -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- About Modal -->
    <div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="aboutModalLabel">About YOLO Detection</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <p>This application demonstrates object detection using YOLO (You Only Look Once) models. It supports multiple YOLO versions including YOLOv5, YOLOv8, and YOLOv11.</p>
            <h6>Features:</h6>
            <ul>
              <li>Real-time object detection</li>
              <li>Support for multiple YOLO model versions</li>
              <li>User-friendly interface</li>
              <li>Drag and drop file upload</li>
            </ul>
            <p>Upload an image to detect objects with bounding boxes and confidence scores.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <script>
        // 主题切换功能
        function initTheme() {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.body.classList.add('dark-mode');
                updateThemeIcon(true);
            } else {
                updateThemeIcon(false);
            }
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            updateThemeIcon(isDark);
            showToast('theme', isDark ? '已切换到深色模式' : '已切换到浅色模式', 'info');
        }

        function updateThemeIcon(isDark) {
            const icons = ['themeIcon', 'themeIconFloat'];
            icons.forEach(iconId => {
                const icon = document.getElementById(iconId);
                if (icon) {
                    icon.className = isDark ? 'fas fa-sun' : 'fas fa-moon';
                }
            });
        }

        // Toast 通知系统
        function showToast(type, message, level = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `custom-toast ${level}`;

            const icons = {
                'success': 'fa-check-circle',
                'error': 'fa-exclamation-circle',
                'warning': 'fa-exclamation-triangle',
                'info': 'fa-info-circle',
                'theme': 'fa-palette'
            };

            const icon = icons[type] || icons['info'];

            toast.innerHTML = `
                <i class="fas ${icon}"></i>
                <span>${message}</span>
            `;

            container.appendChild(toast);

            // 自动移除
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-out';
                setTimeout(() => {
                    if (container.contains(toast)) {
                        container.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }

        // 显示骨架屏加载效果
        function showSkeleton(container, duration = 1000) {
            const skeleton = document.createElement('div');
            skeleton.className = 'skeleton';
            skeleton.style.height = '200px';
            skeleton.style.width = '100%';

            const originalContent = container.innerHTML;
            container.innerHTML = '';
            container.appendChild(skeleton);

            setTimeout(() => {
                container.innerHTML = originalContent;
                container.classList.add('fade-in');
            }, duration);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();

            // 监听系统主题变化
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(e) {
                if (!localStorage.getItem('theme')) {
                    const isDark = e.matches;
                    document.body.classList.toggle('dark-mode', isDark);
                    updateThemeIcon(isDark);
                }
            });

            // 添加滚动动画
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('fade-in');
                    }
                });
            }, observerOptions);

            // 观察所有卡片元素
            document.querySelectorAll('.card').forEach(card => {
                observer.observe(card);
            });
        });

        // 增强的键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + D 切换主题
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                e.preventDefault();
                toggleTheme();
            }
        });

        // 移动端触摸手势支持
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, false);

        document.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            handleSwipeGesture();
        }, false);

        function handleSwipeGesture() {
            const swipeThreshold = 50;
            const xDiff = touchEndX - touchStartX;
            const yDiff = touchEndY - touchStartY;

            // 水平滑动
            if (Math.abs(xDiff) > Math.abs(yDiff)) {
                if (xDiff > swipeThreshold) {
                    // 向右滑动 - 可以触发特定操作
                    console.log('Swipe right');
                } else if (xDiff < -swipeThreshold) {
                    // 向左滑动 - 可以触发特定操作
                    console.log('Swipe left');
                }
            }
            // 垂直滑动
            else {
                if (yDiff > swipeThreshold) {
                    // 向下滑动
                    console.log('Swipe down');
                } else if (yDiff < -swipeThreshold) {
                    // 向上滑动
                    console.log('Swipe up');
                }
            }
        }

        // 移动端振动反馈 (如果支持)
        function vibrate(duration = 50) {
            if ('vibrate' in navigator) {
                navigator.vibrate(duration);
            }
        }

        // 添加触摸反馈到所有按钮
        document.addEventListener('DOMContentLoaded', function() {
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(button => {
                button.addEventListener('touchstart', function() {
                    vibrate(10);
                    this.style.transform = 'scale(0.95)';
                });

                button.addEventListener('touchend', function() {
                    this.style.transform = 'scale(1)';
                });
            });
        });

        // 检测网络状态
        function updateNetworkStatus() {
            const isOnline = navigator.onLine;
            if (!isOnline) {
                showToast('error', '网络连接已断开，部分功能可能不可用', 'error');
            }
        }

        window.addEventListener('online', function() {
            showToast('success', '网络连接已恢复', 'success');
        });

        window.addEventListener('offline', function() {
            showToast('error', '网络连接已断开', 'error');
        });

        // 页面可见性变化处理
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // 页面重新可见时刷新内容
                console.log('Page is now visible');
            }
        });

        // 防抖函数用于优化性能
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // 优化滚动性能
        const optimizedScroll = debounce(function() {
            // 滚动时的处理逻辑
        }, 10);

        window.addEventListener('scroll', optimizedScroll);
    </script>
  </body>
</html>